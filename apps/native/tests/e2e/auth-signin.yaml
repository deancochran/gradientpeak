# Test: Device-Agnostic User Sign In Flow
# Works across iOS and Android with semantic selectors
---
appId: ${APP_BUNDLE_ID}
name: Device-Agnostic User Sign In Flow
tags:
  - auth
  - signin
  - smoke
  - critical

---
# Import device-agnostic helpers
- runFlow: "../../../.maestro/helpers/device-agnostic-helpers.yaml"

# Launch app and wait for initial load
- launchApp
- waitForAnimationToEnd
- assertVisible:
    text: "TurboFit"
    timeout: ${LONG_TIMEOUT}

# Handle any initial modals or onboarding
- runFlow:
    when:
      visible:
        text: "Skip"
    commands:
      - tapOn: "Skip"

# Navigate to Sign In using device-agnostic approach
- tapOn:
    id: "sign-in-button"
    fallback:
      text: "Sign In"
- waitForAnimationToEnd

# Verify we're on the sign in screen
- assertVisible:
    text: "Welcome Back"
    fallback:
      id: "sign-in-screen"
    timeout: ${DEFAULT_TIMEOUT}

# Use helper function for consistent credential entry
- signInFlow:
    email: "${TEST_EMAIL}"
    password: "${TEST_PASSWORD}"

# Wait for authentication to complete
- waitForLoading

# Verify successful authentication with platform-agnostic checks
- verifyAuthenticated

# Verify key dashboard elements are present
- assertVisible:
    id: "record-activity-button"
    fallback:
      text: "Record Activity"
    timeout: ${DEFAULT_TIMEOUT}

- assertVisible:
    id: "activities-list"
    fallback:
      text: "Your Activities"
    timeout: ${DEFAULT_TIMEOUT}

# Test navigation to profile using device-agnostic approach
- navigateToTab:
    tabName: "Profile"

# Verify profile screen elements
- assertVisible:
    id: "account-settings"
    fallback:
      text: "Account Settings"
    timeout: ${DEFAULT_TIMEOUT}

- assertVisible:
    id: "sign-out-button"
    fallback:
      text: "Sign Out"
    timeout: ${DEFAULT_TIMEOUT}

# Test accessibility compliance
- verifyAccessibility

# Return to dashboard for clean state
- navigateToTab:
    tabName: "Dashboard"
    
# Verify we're back on dashboard
- verifyAuthenticated